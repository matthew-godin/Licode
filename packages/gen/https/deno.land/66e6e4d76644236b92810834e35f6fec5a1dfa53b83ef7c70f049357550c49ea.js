import { State } from "../state.ts";
const { hasOwn } = Object;
function compileStyleMap(schema, map) {
    if (typeof map === "undefined" || map === null)
        return {};
    let type;
    const result = {};
    const keys = Object.keys(map);
    let tag, style;
    for (let index = 0, length = keys.length; index < length; index += 1) {
        tag = keys[index];
        style = String(map[tag]);
        if (tag.slice(0, 2) === "!!") {
            tag = `tag:yaml.org,2002:${tag.slice(2)}`;
        }
        type = schema.compiledTypeMap.fallback[tag];
        if (type &&
            typeof type.styleAliases !== "undefined" &&
            hasOwn(type.styleAliases, style)) {
            style = type.styleAliases[style];
        }
        result[tag] = style;
    }
    return result;
}
export class DumperState extends State {
    indent;
    noArrayIndent;
    skipInvalid;
    flowLevel;
    sortKeys;
    lineWidth;
    noRefs;
    noCompatMode;
    condenseFlow;
    implicitTypes;
    explicitTypes;
    tag = null;
    result = "";
    duplicates = [];
    usedDuplicates = [];
    styleMap;
    dump;
    constructor({ schema, indent = 2, noArrayIndent = false, skipInvalid = false, flowLevel = -1, styles = null, sortKeys = false, lineWidth = 80, noRefs = false, noCompatMode = false, condenseFlow = false, }) {
        super(schema);
        this.indent = Math.max(1, indent);
        this.noArrayIndent = noArrayIndent;
        this.skipInvalid = skipInvalid;
        this.flowLevel = flowLevel;
        this.styleMap = compileStyleMap(this.schema, styles);
        this.sortKeys = sortKeys;
        this.lineWidth = lineWidth;
        this.noRefs = noRefs;
        this.noCompatMode = noCompatMode;
        this.condenseFlow = condenseFlow;
        this.implicitTypes = this.schema.compiledImplicit;
        this.explicitTypes = this.schema.compiledExplicit;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVtcGVyX3N0YXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaHR0cHM6Ly9kZW5vLmxhbmQvc3RkQDAuMTI1LjAvZW5jb2RpbmcvX3lhbWwvZHVtcGVyL2R1bXBlcl9zdGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBSXBDLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLENBQUM7QUFFMUIsU0FBUyxlQUFlLENBQ3RCLE1BQWMsRUFDZCxHQUFzQztJQUV0QyxJQUFJLE9BQU8sR0FBRyxLQUFLLFdBQVcsSUFBSSxHQUFHLEtBQUssSUFBSTtRQUFFLE9BQU8sRUFBRSxDQUFDO0lBRTFELElBQUksSUFBVSxDQUFDO0lBQ2YsTUFBTSxNQUFNLEdBQThCLEVBQUUsQ0FBQztJQUM3QyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLElBQUksR0FBVyxFQUFFLEtBQW1CLENBQUM7SUFDckMsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxHQUFHLE1BQU0sRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFO1FBQ3BFLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEIsS0FBSyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQWlCLENBQUM7UUFDekMsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDNUIsR0FBRyxHQUFHLHFCQUFxQixHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7U0FDM0M7UUFDRCxJQUFJLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFNUMsSUFDRSxJQUFJO1lBQ0osT0FBTyxJQUFJLENBQUMsWUFBWSxLQUFLLFdBQVc7WUFDeEMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLEVBQ2hDO1lBQ0EsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDbEM7UUFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0tBQ3JCO0lBRUQsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQW1ERCxNQUFNLE9BQU8sV0FBWSxTQUFRLEtBQUs7SUFDN0IsTUFBTSxDQUFTO0lBQ2YsYUFBYSxDQUFVO0lBQ3ZCLFdBQVcsQ0FBVTtJQUNyQixTQUFTLENBQVM7SUFDbEIsUUFBUSxDQUF5QztJQUNqRCxTQUFTLENBQVM7SUFDbEIsTUFBTSxDQUFVO0lBQ2hCLFlBQVksQ0FBVTtJQUN0QixZQUFZLENBQVU7SUFDdEIsYUFBYSxDQUFTO0lBQ3RCLGFBQWEsQ0FBUztJQUN0QixHQUFHLEdBQWtCLElBQUksQ0FBQztJQUMxQixNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ1osVUFBVSxHQUFVLEVBQUUsQ0FBQztJQUN2QixjQUFjLEdBQVUsRUFBRSxDQUFDO0lBQzNCLFFBQVEsQ0FBNEI7SUFDcEMsSUFBSSxDQUFNO0lBRWpCLFlBQVksRUFDVixNQUFNLEVBQ04sTUFBTSxHQUFHLENBQUMsRUFDVixhQUFhLEdBQUcsS0FBSyxFQUNyQixXQUFXLEdBQUcsS0FBSyxFQUNuQixTQUFTLEdBQUcsQ0FBQyxDQUFDLEVBQ2QsTUFBTSxHQUFHLElBQUksRUFDYixRQUFRLEdBQUcsS0FBSyxFQUNoQixTQUFTLEdBQUcsRUFBRSxFQUNkLE1BQU0sR0FBRyxLQUFLLEVBQ2QsWUFBWSxHQUFHLEtBQUssRUFDcEIsWUFBWSxHQUFHLEtBQUssR0FDRDtRQUNuQixLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFDO1FBQ25DLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxNQUFnQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBRWpDLElBQUksQ0FBQyxhQUFhLEdBQUksSUFBSSxDQUFDLE1BQWlCLENBQUMsZ0JBQWdCLENBQUM7UUFDOUQsSUFBSSxDQUFDLGFBQWEsR0FBSSxJQUFJLENBQUMsTUFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQztJQUNoRSxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQb3J0ZWQgZnJvbSBqcy15YW1sIHYzLjEzLjE6XG4vLyBodHRwczovL2dpdGh1Yi5jb20vbm9kZWNhL2pzLXlhbWwvY29tbWl0LzY2NWFhZGRhNDIzNDlkY2FlODY5ZjEyMDQwZDliMTBlZjE4ZDEyZGFcbi8vIENvcHlyaWdodCAyMDExLTIwMTUgYnkgVml0YWx5IFB1enJpbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG4vLyBDb3B5cmlnaHQgMjAxOC0yMDIyIHRoZSBEZW5vIGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuXG5pbXBvcnQgdHlwZSB7IFNjaGVtYSwgU2NoZW1hRGVmaW5pdGlvbiB9IGZyb20gXCIuLi9zY2hlbWEudHNcIjtcbmltcG9ydCB7IFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlLnRzXCI7XG5pbXBvcnQgdHlwZSB7IFN0eWxlVmFyaWFudCwgVHlwZSB9IGZyb20gXCIuLi90eXBlLnRzXCI7XG5pbXBvcnQgdHlwZSB7IEFueSwgQXJyYXlPYmplY3QgfSBmcm9tIFwiLi4vdXRpbHMudHNcIjtcblxuY29uc3QgeyBoYXNPd24gfSA9IE9iamVjdDtcblxuZnVuY3Rpb24gY29tcGlsZVN0eWxlTWFwKFxuICBzY2hlbWE6IFNjaGVtYSxcbiAgbWFwPzogQXJyYXlPYmplY3Q8U3R5bGVWYXJpYW50PiB8IG51bGwsXG4pOiBBcnJheU9iamVjdDxTdHlsZVZhcmlhbnQ+IHtcbiAgaWYgKHR5cGVvZiBtYXAgPT09IFwidW5kZWZpbmVkXCIgfHwgbWFwID09PSBudWxsKSByZXR1cm4ge307XG5cbiAgbGV0IHR5cGU6IFR5cGU7XG4gIGNvbnN0IHJlc3VsdDogQXJyYXlPYmplY3Q8U3R5bGVWYXJpYW50PiA9IHt9O1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobWFwKTtcbiAgbGV0IHRhZzogc3RyaW5nLCBzdHlsZTogU3R5bGVWYXJpYW50O1xuICBmb3IgKGxldCBpbmRleCA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIHRhZyA9IGtleXNbaW5kZXhdO1xuICAgIHN0eWxlID0gU3RyaW5nKG1hcFt0YWddKSBhcyBTdHlsZVZhcmlhbnQ7XG4gICAgaWYgKHRhZy5zbGljZSgwLCAyKSA9PT0gXCIhIVwiKSB7XG4gICAgICB0YWcgPSBgdGFnOnlhbWwub3JnLDIwMDI6JHt0YWcuc2xpY2UoMil9YDtcbiAgICB9XG4gICAgdHlwZSA9IHNjaGVtYS5jb21waWxlZFR5cGVNYXAuZmFsbGJhY2tbdGFnXTtcblxuICAgIGlmIChcbiAgICAgIHR5cGUgJiZcbiAgICAgIHR5cGVvZiB0eXBlLnN0eWxlQWxpYXNlcyAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgaGFzT3duKHR5cGUuc3R5bGVBbGlhc2VzLCBzdHlsZSlcbiAgICApIHtcbiAgICAgIHN0eWxlID0gdHlwZS5zdHlsZUFsaWFzZXNbc3R5bGVdO1xuICAgIH1cblxuICAgIHJlc3VsdFt0YWddID0gc3R5bGU7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIER1bXBlclN0YXRlT3B0aW9ucyB7XG4gIC8qKiBpbmRlbnRhdGlvbiB3aWR0aCB0byB1c2UgKGluIHNwYWNlcykuICovXG4gIGluZGVudD86IG51bWJlcjtcbiAgLyoqIHdoZW4gdHJ1ZSwgd2lsbCBub3QgYWRkIGFuIGluZGVudGF0aW9uIGxldmVsIHRvIGFycmF5IGVsZW1lbnRzICovXG4gIG5vQXJyYXlJbmRlbnQ/OiBib29sZWFuO1xuICAvKipcbiAgICogZG8gbm90IHRocm93IG9uIGludmFsaWQgdHlwZXMgKGxpa2UgZnVuY3Rpb24gaW4gdGhlIHNhZmUgc2NoZW1hKVxuICAgKiBhbmQgc2tpcCBwYWlycyBhbmQgc2luZ2xlIHZhbHVlcyB3aXRoIHN1Y2ggdHlwZXMuXG4gICAqL1xuICBza2lwSW52YWxpZD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBzcGVjaWZpZXMgbGV2ZWwgb2YgbmVzdGluZywgd2hlbiB0byBzd2l0Y2ggZnJvbVxuICAgKiBibG9jayB0byBmbG93IHN0eWxlIGZvciBjb2xsZWN0aW9ucy4gLTEgbWVhbnMgYmxvY2sgc3R5bGUgZXZlcnl3aGVyZVxuICAgKi9cbiAgZmxvd0xldmVsPzogbnVtYmVyO1xuICAvKiogRWFjaCB0YWcgbWF5IGhhdmUgb3duIHNldCBvZiBzdHlsZXMuXHQtIFwidGFnXCIgPT4gXCJzdHlsZVwiIG1hcC4gKi9cbiAgc3R5bGVzPzogQXJyYXlPYmplY3Q8U3R5bGVWYXJpYW50PiB8IG51bGw7XG4gIC8qKiBzcGVjaWZpZXMgYSBzY2hlbWEgdG8gdXNlLiAqL1xuICBzY2hlbWE/OiBTY2hlbWFEZWZpbml0aW9uO1xuICAvKipcbiAgICogSWYgdHJ1ZSwgc29ydCBrZXlzIHdoZW4gZHVtcGluZyBZQU1MIGluIGFzY2VuZGluZywgQVNDSUkgY2hhcmFjdGVyIG9yZGVyLlxuICAgKiBJZiBhIGZ1bmN0aW9uLCB1c2UgdGhlIGZ1bmN0aW9uIHRvIHNvcnQgdGhlIGtleXMuIChkZWZhdWx0OiBmYWxzZSlcbiAgICogSWYgYSBmdW5jdGlvbiBpcyBzcGVjaWZpZWQsIHRoZSBmdW5jdGlvbiBtdXN0IHJldHVybiBhIG5lZ2F0aXZlIHZhbHVlXG4gICAqIGlmIGZpcnN0IGFyZ3VtZW50IGlzIGxlc3MgdGhhbiBzZWNvbmQgYXJndW1lbnQsIHplcm8gaWYgdGhleSdyZSBlcXVhbFxuICAgKiBhbmQgYSBwb3NpdGl2ZSB2YWx1ZSBvdGhlcndpc2UuXG4gICAqL1xuICBzb3J0S2V5cz86IGJvb2xlYW4gfCAoKGE6IHN0cmluZywgYjogc3RyaW5nKSA9PiBudW1iZXIpO1xuICAvKiogc2V0IG1heCBsaW5lIHdpZHRoLiAoZGVmYXVsdDogODApICovXG4gIGxpbmVXaWR0aD86IG51bWJlcjtcbiAgLyoqXG4gICAqIGlmIHRydWUsIGRvbid0IGNvbnZlcnQgZHVwbGljYXRlIG9iamVjdHNcbiAgICogaW50byByZWZlcmVuY2VzIChkZWZhdWx0OiBmYWxzZSlcbiAgICovXG4gIG5vUmVmcz86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBpZiB0cnVlIGRvbid0IHRyeSB0byBiZSBjb21wYXRpYmxlIHdpdGggb2xkZXIgeWFtbCB2ZXJzaW9ucy5cbiAgICogQ3VycmVudGx5OiBkb24ndCBxdW90ZSBcInllc1wiLCBcIm5vXCIgYW5kIHNvIG9uLFxuICAgKiBhcyByZXF1aXJlZCBmb3IgWUFNTCAxLjEgKGRlZmF1bHQ6IGZhbHNlKVxuICAgKi9cbiAgbm9Db21wYXRNb2RlPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIGlmIHRydWUgZmxvdyBzZXF1ZW5jZXMgd2lsbCBiZSBjb25kZW5zZWQsIG9taXR0aW5nIHRoZVxuICAgKiBzcGFjZSBiZXR3ZWVuIGBrZXk6IHZhbHVlYCBvciBgYSwgYmAuIEVnLiBgJ1thLGJdJ2Agb3IgYHthOntiOmN9fWAuXG4gICAqIENhbiBiZSB1c2VmdWwgd2hlbiB1c2luZyB5YW1sIGZvciBwcmV0dHkgVVJMIHF1ZXJ5IHBhcmFtc1xuICAgKiBhcyBzcGFjZXMgYXJlICUtZW5jb2RlZC4gKGRlZmF1bHQ6IGZhbHNlKS5cbiAgICovXG4gIGNvbmRlbnNlRmxvdz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBEdW1wZXJTdGF0ZSBleHRlbmRzIFN0YXRlIHtcbiAgcHVibGljIGluZGVudDogbnVtYmVyO1xuICBwdWJsaWMgbm9BcnJheUluZGVudDogYm9vbGVhbjtcbiAgcHVibGljIHNraXBJbnZhbGlkOiBib29sZWFuO1xuICBwdWJsaWMgZmxvd0xldmVsOiBudW1iZXI7XG4gIHB1YmxpYyBzb3J0S2V5czogYm9vbGVhbiB8ICgoYTogQW55LCBiOiBBbnkpID0+IG51bWJlcik7XG4gIHB1YmxpYyBsaW5lV2lkdGg6IG51bWJlcjtcbiAgcHVibGljIG5vUmVmczogYm9vbGVhbjtcbiAgcHVibGljIG5vQ29tcGF0TW9kZTogYm9vbGVhbjtcbiAgcHVibGljIGNvbmRlbnNlRmxvdzogYm9vbGVhbjtcbiAgcHVibGljIGltcGxpY2l0VHlwZXM6IFR5cGVbXTtcbiAgcHVibGljIGV4cGxpY2l0VHlwZXM6IFR5cGVbXTtcbiAgcHVibGljIHRhZzogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHB1YmxpYyByZXN1bHQgPSBcIlwiO1xuICBwdWJsaWMgZHVwbGljYXRlczogQW55W10gPSBbXTtcbiAgcHVibGljIHVzZWREdXBsaWNhdGVzOiBBbnlbXSA9IFtdOyAvLyBjaGFuZ2VkIGZyb20gbnVsbCB0byBbXVxuICBwdWJsaWMgc3R5bGVNYXA6IEFycmF5T2JqZWN0PFN0eWxlVmFyaWFudD47XG4gIHB1YmxpYyBkdW1wOiBBbnk7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIHNjaGVtYSxcbiAgICBpbmRlbnQgPSAyLFxuICAgIG5vQXJyYXlJbmRlbnQgPSBmYWxzZSxcbiAgICBza2lwSW52YWxpZCA9IGZhbHNlLFxuICAgIGZsb3dMZXZlbCA9IC0xLFxuICAgIHN0eWxlcyA9IG51bGwsXG4gICAgc29ydEtleXMgPSBmYWxzZSxcbiAgICBsaW5lV2lkdGggPSA4MCxcbiAgICBub1JlZnMgPSBmYWxzZSxcbiAgICBub0NvbXBhdE1vZGUgPSBmYWxzZSxcbiAgICBjb25kZW5zZUZsb3cgPSBmYWxzZSxcbiAgfTogRHVtcGVyU3RhdGVPcHRpb25zKSB7XG4gICAgc3VwZXIoc2NoZW1hKTtcbiAgICB0aGlzLmluZGVudCA9IE1hdGgubWF4KDEsIGluZGVudCk7XG4gICAgdGhpcy5ub0FycmF5SW5kZW50ID0gbm9BcnJheUluZGVudDtcbiAgICB0aGlzLnNraXBJbnZhbGlkID0gc2tpcEludmFsaWQ7XG4gICAgdGhpcy5mbG93TGV2ZWwgPSBmbG93TGV2ZWw7XG4gICAgdGhpcy5zdHlsZU1hcCA9IGNvbXBpbGVTdHlsZU1hcCh0aGlzLnNjaGVtYSBhcyBTY2hlbWEsIHN0eWxlcyk7XG4gICAgdGhpcy5zb3J0S2V5cyA9IHNvcnRLZXlzO1xuICAgIHRoaXMubGluZVdpZHRoID0gbGluZVdpZHRoO1xuICAgIHRoaXMubm9SZWZzID0gbm9SZWZzO1xuICAgIHRoaXMubm9Db21wYXRNb2RlID0gbm9Db21wYXRNb2RlO1xuICAgIHRoaXMuY29uZGVuc2VGbG93ID0gY29uZGVuc2VGbG93O1xuXG4gICAgdGhpcy5pbXBsaWNpdFR5cGVzID0gKHRoaXMuc2NoZW1hIGFzIFNjaGVtYSkuY29tcGlsZWRJbXBsaWNpdDtcbiAgICB0aGlzLmV4cGxpY2l0VHlwZXMgPSAodGhpcy5zY2hlbWEgYXMgU2NoZW1hKS5jb21waWxlZEV4cGxpY2l0O1xuICB9XG59XG4iXX0=