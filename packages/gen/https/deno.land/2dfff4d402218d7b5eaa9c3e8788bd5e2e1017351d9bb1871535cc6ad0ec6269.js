const reVersion = /^v?[0-9]+\.[0-9]+\.[0-9]+$/;
export function parseArgs(args = Deno.args) {
    if (args[0] === "--") {
        args = args.slice(1);
    }
    const flags = {
        help: false,
        version: false,
        init: undefined,
        upgrade: undefined,
        config: undefined,
        cmd: [],
    };
    if ((args.includes("--config") || args.includes("-c")) && args.length > 1) {
        flags.config = args[1];
        args = args.slice(2);
    }
    if (args.includes("--help") || args.includes("-h")) {
        flags.help = true;
        args = args.slice(1);
    }
    if (args.includes("--version") || args.includes("-v")) {
        flags.version = true;
        args = args.slice(1);
    }
    if (args.includes("--init") || args.includes("-i")) {
        const index = args.includes("--init")
            ? args.indexOf("--init")
            : args.indexOf("-i");
        const next = args[index + 1];
        if (next) {
            flags.init = next;
            args = args.slice(2);
        }
        else {
            flags.init = "json";
            args = args.slice(1);
        }
    }
    if (args.includes("--upgrade") || args.includes("-u")) {
        const index = args.includes("--upgrade")
            ? args.indexOf("--upgrade")
            : args.indexOf("-u");
        const next = args[index + 1];
        if (next && (next === "latest" || reVersion.test(next))) {
            flags.upgrade = !next.startsWith("v") || next !== "latest"
                ? "v" + next
                : next;
            args = args.slice(2);
        }
        else {
            flags.upgrade = "latest";
            args = args.slice(1);
        }
    }
    flags.cmd = args;
    return flags;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJncy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvZGVub25AMi41LjAvc3JjL2FyZ3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsTUFBTSxTQUFTLEdBQUcsNEJBQTRCLENBQUM7QUFpQi9DLE1BQU0sVUFBVSxTQUFTLENBQUMsT0FBaUIsSUFBSSxDQUFDLElBQUk7SUFDbEQsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3RCO0lBRUQsTUFBTSxLQUFLLEdBQVM7UUFDbEIsSUFBSSxFQUFFLEtBQUs7UUFDWCxPQUFPLEVBQUUsS0FBSztRQUNkLElBQUksRUFBRSxTQUFTO1FBQ2YsT0FBTyxFQUFFLFNBQVM7UUFDbEIsTUFBTSxFQUFFLFNBQVM7UUFDakIsR0FBRyxFQUFFLEVBQUU7S0FDUixDQUFDO0lBRUYsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQ3pFLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3RCO0lBRUQsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDbEQsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDdEI7SUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNyRCxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUN0QjtJQUVELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ2xELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDO1lBQ25DLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztZQUN4QixDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRTdCLElBQUksSUFBSSxFQUFFO1lBQ1IsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDbEIsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdEI7YUFBTTtZQUNMLEtBQUssQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDO1lBQ3BCLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RCO0tBQ0Y7SUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNyRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztZQUN0QyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7WUFDM0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztRQUU3QixJQUFJLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxRQUFRLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ3ZELEtBQUssQ0FBQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksS0FBSyxRQUFRO2dCQUN4RCxDQUFDLENBQUMsR0FBRyxHQUFHLElBQUk7Z0JBQ1osQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNULElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RCO2FBQU07WUFDTCxLQUFLLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQztZQUN6QixJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN0QjtLQUNGO0lBRUQsS0FBSyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7SUFDakIsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMSB0aGUgZGVub3NhdXJzIHRlYW0uIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuXG4vKiogUmVnZXggdG8gdGVzdCBpZiBzdHJpbmcgbWF0Y2hlcyB2ZXJzaW9uIGZvcm1hdCAqL1xuY29uc3QgcmVWZXJzaW9uID0gL152P1swLTldK1xcLlswLTldK1xcLlswLTldKyQvO1xuXG4vKiogTWFwIG9mIHN1cHBvcnRlZCBmbGFncyB0aGF0IG1vZGlmeVxuICogYGRlbm9uYCBiZWhhdmlvci4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXJncyB7XG4gIGhlbHA6IGJvb2xlYW47XG4gIHZlcnNpb246IGJvb2xlYW47XG5cbiAgaW5pdD86IHN0cmluZztcbiAgdXBncmFkZT86IHN0cmluZztcbiAgY29uZmlnPzogc3RyaW5nO1xuXG4gIGNtZDogc3RyaW5nW107XG59XG5cbi8qKiBQYXJzZSBEZW5vLmFyZ3MgaW50byBhIGZsYWcgbWFwIChgQXJnc2ApXG4gKiB0byBiZSBoYW5kbGVkIGJ5IHRoIENMSS4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUFyZ3MoYXJnczogc3RyaW5nW10gPSBEZW5vLmFyZ3MpOiBBcmdzIHtcbiAgaWYgKGFyZ3NbMF0gPT09IFwiLS1cIikge1xuICAgIGFyZ3MgPSBhcmdzLnNsaWNlKDEpO1xuICB9XG5cbiAgY29uc3QgZmxhZ3M6IEFyZ3MgPSB7XG4gICAgaGVscDogZmFsc2UsXG4gICAgdmVyc2lvbjogZmFsc2UsXG4gICAgaW5pdDogdW5kZWZpbmVkLFxuICAgIHVwZ3JhZGU6IHVuZGVmaW5lZCxcbiAgICBjb25maWc6IHVuZGVmaW5lZCxcbiAgICBjbWQ6IFtdLFxuICB9O1xuXG4gIGlmICgoYXJncy5pbmNsdWRlcyhcIi0tY29uZmlnXCIpIHx8IGFyZ3MuaW5jbHVkZXMoXCItY1wiKSkgJiYgYXJncy5sZW5ndGggPiAxKSB7XG4gICAgZmxhZ3MuY29uZmlnID0gYXJnc1sxXTtcbiAgICBhcmdzID0gYXJncy5zbGljZSgyKTtcbiAgfVxuXG4gIGlmIChhcmdzLmluY2x1ZGVzKFwiLS1oZWxwXCIpIHx8IGFyZ3MuaW5jbHVkZXMoXCItaFwiKSkge1xuICAgIGZsYWdzLmhlbHAgPSB0cnVlO1xuICAgIGFyZ3MgPSBhcmdzLnNsaWNlKDEpO1xuICB9XG5cbiAgaWYgKGFyZ3MuaW5jbHVkZXMoXCItLXZlcnNpb25cIikgfHwgYXJncy5pbmNsdWRlcyhcIi12XCIpKSB7XG4gICAgZmxhZ3MudmVyc2lvbiA9IHRydWU7XG4gICAgYXJncyA9IGFyZ3Muc2xpY2UoMSk7XG4gIH1cblxuICBpZiAoYXJncy5pbmNsdWRlcyhcIi0taW5pdFwiKSB8fCBhcmdzLmluY2x1ZGVzKFwiLWlcIikpIHtcbiAgICBjb25zdCBpbmRleCA9IGFyZ3MuaW5jbHVkZXMoXCItLWluaXRcIilcbiAgICAgID8gYXJncy5pbmRleE9mKFwiLS1pbml0XCIpXG4gICAgICA6IGFyZ3MuaW5kZXhPZihcIi1pXCIpO1xuICAgIGNvbnN0IG5leHQgPSBhcmdzW2luZGV4ICsgMV07XG5cbiAgICBpZiAobmV4dCkge1xuICAgICAgZmxhZ3MuaW5pdCA9IG5leHQ7XG4gICAgICBhcmdzID0gYXJncy5zbGljZSgyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmxhZ3MuaW5pdCA9IFwianNvblwiO1xuICAgICAgYXJncyA9IGFyZ3Muc2xpY2UoMSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGFyZ3MuaW5jbHVkZXMoXCItLXVwZ3JhZGVcIikgfHwgYXJncy5pbmNsdWRlcyhcIi11XCIpKSB7XG4gICAgY29uc3QgaW5kZXggPSBhcmdzLmluY2x1ZGVzKFwiLS11cGdyYWRlXCIpXG4gICAgICA/IGFyZ3MuaW5kZXhPZihcIi0tdXBncmFkZVwiKVxuICAgICAgOiBhcmdzLmluZGV4T2YoXCItdVwiKTtcbiAgICBjb25zdCBuZXh0ID0gYXJnc1tpbmRleCArIDFdO1xuXG4gICAgaWYgKG5leHQgJiYgKG5leHQgPT09IFwibGF0ZXN0XCIgfHwgcmVWZXJzaW9uLnRlc3QobmV4dCkpKSB7XG4gICAgICBmbGFncy51cGdyYWRlID0gIW5leHQuc3RhcnRzV2l0aChcInZcIikgfHwgbmV4dCAhPT0gXCJsYXRlc3RcIlxuICAgICAgICA/IFwidlwiICsgbmV4dFxuICAgICAgICA6IG5leHQ7XG4gICAgICBhcmdzID0gYXJncy5zbGljZSgyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmxhZ3MudXBncmFkZSA9IFwibGF0ZXN0XCI7XG4gICAgICBhcmdzID0gYXJncy5zbGljZSgxKTtcbiAgICB9XG4gIH1cblxuICBmbGFncy5jbWQgPSBhcmdzO1xuICByZXR1cm4gZmxhZ3M7XG59XG4iXX0=