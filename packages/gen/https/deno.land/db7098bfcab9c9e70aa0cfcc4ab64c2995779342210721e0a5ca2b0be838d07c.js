import { Status } from "./deps.ts";
import { createHttpError } from "./httpError.ts";
export function createMockApp(state = {}) {
    const app = {
        state,
        use() {
            return app;
        },
        [Symbol.for("Deno.customInspect")]() {
            return `MockApplication {}`;
        },
    };
    return app;
}
export const mockContextState = {
    encodingsAccepted: "identity",
};
export function createMockContext({ app, ip = "127.0.0.1", method = "GET", params, path = "/", state, } = {}) {
    if (!app) {
        app = createMockApp(state);
    }
    let body;
    let status = Status.OK;
    const headers = new Headers();
    const resources = [];
    return {
        app,
        params,
        request: {
            acceptsEncodings() {
                return mockContextState.encodingsAccepted;
            },
            headers: new Headers(),
            ip,
            method,
            path,
            search: undefined,
            searchParams: new URLSearchParams(),
            url: new URL(path, "http://localhost/"),
        },
        response: {
            get status() {
                return status;
            },
            set status(value) {
                status = value;
            },
            get body() {
                return body;
            },
            set body(value) {
                body = value;
            },
            addResource(rid) {
                resources.push(rid);
            },
            destroy() {
                body = undefined;
                for (const rid of resources) {
                    Deno.close(rid);
                }
            },
            redirect(url) {
                headers.set("Location", encodeURI(String(url)));
            },
            headers,
            toDomResponse() {
                return Promise.resolve(new Response(body, { status, headers }));
            },
            toServerResponse() {
                return Promise.resolve({
                    status,
                    body,
                    headers,
                });
            },
        },
        state: Object.assign({}, app.state),
        assert(condition, errorStatus = 500, message, props) {
            if (condition) {
                return;
            }
            const err = createHttpError(errorStatus, message);
            if (props) {
                Object.assign(err, props);
            }
            throw err;
        },
        throw(errorStatus, message, props) {
            const err = createHttpError(errorStatus, message);
            if (props) {
                Object.assign(err, props);
            }
            throw err;
        },
        [Symbol.for("Deno.customInspect")]() {
            return `MockContext {}`;
        },
    };
}
export function createMockNext() {
    return async function next() { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRlc3RpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBUUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFLakQsTUFBTSxVQUFVLGFBQWEsQ0FHM0IsUUFBUSxFQUFPO0lBRWYsTUFBTSxHQUFHLEdBQUc7UUFDVixLQUFLO1FBQ0wsR0FBRztZQUNELE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQztRQUNELENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2hDLE9BQU8sb0JBQW9CLENBQUM7UUFDOUIsQ0FBQztLQUNLLENBQUM7SUFDVCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUM7QUFnQkQsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUc7SUFHOUIsaUJBQWlCLEVBQUUsVUFBVTtDQUM5QixDQUFDO0FBR0YsTUFBTSxVQUFVLGlCQUFpQixDQUkvQixFQUNFLEdBQUcsRUFDSCxFQUFFLEdBQUcsV0FBVyxFQUNoQixNQUFNLEdBQUcsS0FBSyxFQUNkLE1BQU0sRUFDTixJQUFJLEdBQUcsR0FBRyxFQUNWLEtBQUssTUFDaUIsRUFBRTtJQUUxQixJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ1IsR0FBRyxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM1QjtJQUNELElBQUksSUFBUyxDQUFDO0lBQ2QsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUN2QixNQUFNLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBQzlCLE1BQU0sU0FBUyxHQUFhLEVBQUUsQ0FBQztJQUMvQixPQUFRO1FBQ04sR0FBRztRQUNILE1BQU07UUFDTixPQUFPLEVBQUU7WUFDUCxnQkFBZ0I7Z0JBQ2QsT0FBTyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQztZQUM1QyxDQUFDO1lBQ0QsT0FBTyxFQUFFLElBQUksT0FBTyxFQUFFO1lBQ3RCLEVBQUU7WUFDRixNQUFNO1lBQ04sSUFBSTtZQUNKLE1BQU0sRUFBRSxTQUFTO1lBQ2pCLFlBQVksRUFBRSxJQUFJLGVBQWUsRUFBRTtZQUNuQyxHQUFHLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLG1CQUFtQixDQUFDO1NBQ3hDO1FBQ0QsUUFBUSxFQUFFO1lBQ1IsSUFBSSxNQUFNO2dCQUNSLE9BQU8sTUFBTSxDQUFDO1lBQ2hCLENBQUM7WUFDRCxJQUFJLE1BQU0sQ0FBQyxLQUFhO2dCQUN0QixNQUFNLEdBQUcsS0FBSyxDQUFDO1lBQ2pCLENBQUM7WUFDRCxJQUFJLElBQUk7Z0JBQ04sT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBQ0QsSUFBSSxJQUFJLENBQUMsS0FBVTtnQkFDakIsSUFBSSxHQUFHLEtBQUssQ0FBQztZQUNmLENBQUM7WUFDRCxXQUFXLENBQUMsR0FBVztnQkFDckIsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixDQUFDO1lBQ0QsT0FBTztnQkFDTCxJQUFJLEdBQUcsU0FBUyxDQUFDO2dCQUNqQixLQUFLLE1BQU0sR0FBRyxJQUFJLFNBQVMsRUFBRTtvQkFDM0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDakI7WUFDSCxDQUFDO1lBQ0QsUUFBUSxDQUFDLEdBQWlCO2dCQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsRCxDQUFDO1lBQ0QsT0FBTztZQUNQLGFBQWE7Z0JBQ1gsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDbEUsQ0FBQztZQUNELGdCQUFnQjtnQkFDZCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7b0JBQ3JCLE1BQU07b0JBQ04sSUFBSTtvQkFDSixPQUFPO2lCQUNSLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRjtRQUNELEtBQUssRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ25DLE1BQU0sQ0FDSixTQUFjLEVBQ2QsY0FBMkIsR0FBRyxFQUM5QixPQUFnQixFQUNoQixLQUErQjtZQUUvQixJQUFJLFNBQVMsRUFBRTtnQkFDYixPQUFPO2FBQ1I7WUFDRCxNQUFNLEdBQUcsR0FBRyxlQUFlLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ2xELElBQUksS0FBSyxFQUFFO2dCQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQzNCO1lBQ0QsTUFBTSxHQUFHLENBQUM7UUFDWixDQUFDO1FBQ0QsS0FBSyxDQUNILFdBQXdCLEVBQ3hCLE9BQWdCLEVBQ2hCLEtBQStCO1lBRS9CLE1BQU0sR0FBRyxHQUFHLGVBQWUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDbEQsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDM0I7WUFDRCxNQUFNLEdBQUcsQ0FBQztRQUNaLENBQUM7UUFDRCxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNoQyxPQUFPLGdCQUFnQixDQUFDO1FBQzFCLENBQUM7S0FDaUMsQ0FBQztBQUN2QyxDQUFDO0FBSUQsTUFBTSxVQUFVLGNBQWM7SUFDNUIsT0FBTyxLQUFLLFVBQVUsSUFBSSxLQUFJLENBQUMsQ0FBQztBQUNsQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMSB0aGUgb2FrIGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuXG4vLyBkZW5vLWxpbnQtaWdub3JlLWZpbGUgbm8tZXhwbGljaXQtYW55XG5cbi8vIEEgbW9kdWxlIG9mIHV0aWxpdHkgZnVuY3Rpb25zIHdoaWNoIGNhbiBtYWtlIHRlc3RpbmcgYW4gb2FrIGFwcGxpY2F0aW9uXG4vLyBlYXNpZXIuXG5cbmltcG9ydCB0eXBlIHsgQXBwbGljYXRpb24sIFN0YXRlIH0gZnJvbSBcIi4vYXBwbGljYXRpb24udHNcIjtcbmltcG9ydCB7IFN0YXR1cyB9IGZyb20gXCIuL2RlcHMudHNcIjtcbmltcG9ydCB7IGNyZWF0ZUh0dHBFcnJvciB9IGZyb20gXCIuL2h0dHBFcnJvci50c1wiO1xuaW1wb3J0IHR5cGUgeyBSb3V0ZVBhcmFtcywgUm91dGVyQ29udGV4dCB9IGZyb20gXCIuL3JvdXRlci50c1wiO1xuaW1wb3J0IHR5cGUgeyBFcnJvclN0YXR1cyB9IGZyb20gXCIuL3R5cGVzLmQudHNcIjtcblxuLyoqIENyZWF0ZXMgYSBtb2NrIG9mIGBBcHBsaWNhdGlvbmAuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0FwcDxcbiAgUyBleHRlbmRzIFJlY29yZDxzdHJpbmcgfCBudW1iZXIgfCBzeW1ib2wsIGFueT4gPSBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuPihcbiAgc3RhdGUgPSB7fSBhcyBTLFxuKTogQXBwbGljYXRpb248Uz4ge1xuICBjb25zdCBhcHAgPSB7XG4gICAgc3RhdGUsXG4gICAgdXNlKCkge1xuICAgICAgcmV0dXJuIGFwcDtcbiAgICB9LFxuICAgIFtTeW1ib2wuZm9yKFwiRGVuby5jdXN0b21JbnNwZWN0XCIpXSgpIHtcbiAgICAgIHJldHVybiBgTW9ja0FwcGxpY2F0aW9uIHt9YDtcbiAgICB9LFxuICB9IGFzIGFueTtcbiAgcmV0dXJuIGFwcDtcbn1cblxuLyoqIE9wdGlvbnMgdGhhdCBjYW4gYmUgc2V0IGluIGEgbW9jayBjb250ZXh0LiAqL1xuZXhwb3J0IGludGVyZmFjZSBNb2NrQ29udGV4dE9wdGlvbnM8XG4gIFAgZXh0ZW5kcyBSb3V0ZVBhcmFtcyA9IFJvdXRlUGFyYW1zLFxuICBTIGV4dGVuZHMgU3RhdGUgPSBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuPiB7XG4gIGFwcD86IEFwcGxpY2F0aW9uPFM+O1xuICBpcD86IHN0cmluZztcbiAgbWV0aG9kPzogc3RyaW5nO1xuICBwYXJhbXM/OiBQO1xuICBwYXRoPzogc3RyaW5nO1xuICBzdGF0ZT86IFM7XG59XG5cbi8qKiBBbGxvd3MgZXh0ZXJuYWwgcGFydGllcyB0byBtb2RpZnkgdGhlIGNvbnRleHQgc3RhdGUuICovXG5leHBvcnQgY29uc3QgbW9ja0NvbnRleHRTdGF0ZSA9IHtcbiAgLyoqIEFkanVzdHMgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgYGFjY2VwdGVkRW5jb2RpbmdzYCBpbiB0aGUgY29udGV4dCdzXG4gICAqIGByZXF1ZXN0YCBvYmplY3QuICovXG4gIGVuY29kaW5nc0FjY2VwdGVkOiBcImlkZW50aXR5XCIsXG59O1xuXG4vKiogQ3JlYXRlIGEgbW9jayBvZiBgQ29udGV4dGAgb3IgYFJvdXRlckNvbnRleHRgLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tDb250ZXh0PFxuICBQIGV4dGVuZHMgUm91dGVQYXJhbXMgPSBSb3V0ZVBhcmFtcyxcbiAgUyBleHRlbmRzIFN0YXRlID0gUmVjb3JkPHN0cmluZywgYW55Pixcbj4oXG4gIHtcbiAgICBhcHAsXG4gICAgaXAgPSBcIjEyNy4wLjAuMVwiLFxuICAgIG1ldGhvZCA9IFwiR0VUXCIsXG4gICAgcGFyYW1zLFxuICAgIHBhdGggPSBcIi9cIixcbiAgICBzdGF0ZSxcbiAgfTogTW9ja0NvbnRleHRPcHRpb25zID0ge30sXG4pIHtcbiAgaWYgKCFhcHApIHtcbiAgICBhcHAgPSBjcmVhdGVNb2NrQXBwKHN0YXRlKTtcbiAgfVxuICBsZXQgYm9keTogYW55O1xuICBsZXQgc3RhdHVzID0gU3RhdHVzLk9LO1xuICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgY29uc3QgcmVzb3VyY2VzOiBudW1iZXJbXSA9IFtdO1xuICByZXR1cm4gKHtcbiAgICBhcHAsXG4gICAgcGFyYW1zLFxuICAgIHJlcXVlc3Q6IHtcbiAgICAgIGFjY2VwdHNFbmNvZGluZ3MoKSB7XG4gICAgICAgIHJldHVybiBtb2NrQ29udGV4dFN0YXRlLmVuY29kaW5nc0FjY2VwdGVkO1xuICAgICAgfSxcbiAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKCksXG4gICAgICBpcCxcbiAgICAgIG1ldGhvZCxcbiAgICAgIHBhdGgsXG4gICAgICBzZWFyY2g6IHVuZGVmaW5lZCxcbiAgICAgIHNlYXJjaFBhcmFtczogbmV3IFVSTFNlYXJjaFBhcmFtcygpLFxuICAgICAgdXJsOiBuZXcgVVJMKHBhdGgsIFwiaHR0cDovL2xvY2FsaG9zdC9cIiksXG4gICAgfSxcbiAgICByZXNwb25zZToge1xuICAgICAgZ2V0IHN0YXR1cygpOiBTdGF0dXMge1xuICAgICAgICByZXR1cm4gc3RhdHVzO1xuICAgICAgfSxcbiAgICAgIHNldCBzdGF0dXModmFsdWU6IFN0YXR1cykge1xuICAgICAgICBzdGF0dXMgPSB2YWx1ZTtcbiAgICAgIH0sXG4gICAgICBnZXQgYm9keSgpOiBhbnkge1xuICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgIH0sXG4gICAgICBzZXQgYm9keSh2YWx1ZTogYW55KSB7XG4gICAgICAgIGJvZHkgPSB2YWx1ZTtcbiAgICAgIH0sXG4gICAgICBhZGRSZXNvdXJjZShyaWQ6IG51bWJlcikge1xuICAgICAgICByZXNvdXJjZXMucHVzaChyaWQpO1xuICAgICAgfSxcbiAgICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGJvZHkgPSB1bmRlZmluZWQ7XG4gICAgICAgIGZvciAoY29uc3QgcmlkIG9mIHJlc291cmNlcykge1xuICAgICAgICAgIERlbm8uY2xvc2UocmlkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlZGlyZWN0KHVybDogc3RyaW5nIHwgVVJMKSB7XG4gICAgICAgIGhlYWRlcnMuc2V0KFwiTG9jYXRpb25cIiwgZW5jb2RlVVJJKFN0cmluZyh1cmwpKSk7XG4gICAgICB9LFxuICAgICAgaGVhZGVycyxcbiAgICAgIHRvRG9tUmVzcG9uc2UoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IFJlc3BvbnNlKGJvZHksIHsgc3RhdHVzLCBoZWFkZXJzIH0pKTtcbiAgICAgIH0sXG4gICAgICB0b1NlcnZlclJlc3BvbnNlKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgYm9keSxcbiAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICBzdGF0ZTogT2JqZWN0LmFzc2lnbih7fSwgYXBwLnN0YXRlKSxcbiAgICBhc3NlcnQoXG4gICAgICBjb25kaXRpb246IGFueSxcbiAgICAgIGVycm9yU3RhdHVzOiBFcnJvclN0YXR1cyA9IDUwMCxcbiAgICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgICBwcm9wcz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICk6IGFzc2VydHMgY29uZGl0aW9uIHtcbiAgICAgIGlmIChjb25kaXRpb24pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZXJyID0gY3JlYXRlSHR0cEVycm9yKGVycm9yU3RhdHVzLCBtZXNzYWdlKTtcbiAgICAgIGlmIChwcm9wcykge1xuICAgICAgICBPYmplY3QuYXNzaWduKGVyciwgcHJvcHMpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH0sXG4gICAgdGhyb3coXG4gICAgICBlcnJvclN0YXR1czogRXJyb3JTdGF0dXMsXG4gICAgICBtZXNzYWdlPzogc3RyaW5nLFxuICAgICAgcHJvcHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgICApOiBuZXZlciB7XG4gICAgICBjb25zdCBlcnIgPSBjcmVhdGVIdHRwRXJyb3IoZXJyb3JTdGF0dXMsIG1lc3NhZ2UpO1xuICAgICAgaWYgKHByb3BzKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24oZXJyLCBwcm9wcyk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSxcbiAgICBbU3ltYm9sLmZvcihcIkRlbm8uY3VzdG9tSW5zcGVjdFwiKV0oKSB7XG4gICAgICByZXR1cm4gYE1vY2tDb250ZXh0IHt9YDtcbiAgICB9LFxuICB9IGFzIHVua25vd24pIGFzIFJvdXRlckNvbnRleHQ8UCwgUz47XG59XG5cbi8qKiBDcmVhdGVzIGEgbW9jayBgbmV4dCgpYCBmdW5jdGlvbiB3aGljaCBjYW4gYmUgdXNlZCB3aGVuIGNhbGxpbmdcbiAqIG1pZGRsZXdhcmUuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja05leHQoKSB7XG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiBuZXh0KCkge307XG59XG4iXX0=