import { bold, yellow } from "../deps.ts";
export function readInt16BE(buffer, offset) {
    offset = offset >>> 0;
    const val = buffer[offset + 1] | (buffer[offset] << 8);
    return val & 0x8000 ? val | 0xffff0000 : val;
}
export function readUInt16BE(buffer, offset) {
    offset = offset >>> 0;
    return buffer[offset] | (buffer[offset + 1] << 8);
}
export function readInt32BE(buffer, offset) {
    offset = offset >>> 0;
    return ((buffer[offset] << 24) |
        (buffer[offset + 1] << 16) |
        (buffer[offset + 2] << 8) |
        buffer[offset + 3]);
}
export function readUInt32BE(buffer, offset) {
    offset = offset >>> 0;
    return (buffer[offset] * 0x1000000 +
        ((buffer[offset + 1] << 16) |
            (buffer[offset + 2] << 8) |
            buffer[offset + 3]));
}
export function parseConnectionUri(uri) {
    const parsed_uri = uri.match(/(?<driver>\w+):\/{2}((?<user>[^\/?#\s:]+?)?(:(?<password>[^\/?#\s]+)?)?@)?(?<full_host>[^\/?#\s]+)?(\/(?<path>[^?#\s]*))?(\?(?<params>[^#\s]+))?.*/);
    if (!parsed_uri)
        throw new Error("Could not parse the provided URL");
    let { driver = "", full_host = "", params = "", password = "", path = "", user = "", } = parsed_uri.groups ?? {};
    const parsed_host = full_host.match(/(?<host>(\[.+\])|(.*?))(:(?<port>[\w]*))?$/);
    if (!parsed_host)
        throw new Error(`Could not parse "${full_host}" host`);
    let { host = "", port = "", } = parsed_host.groups ?? {};
    try {
        if (host) {
            host = decodeURIComponent(host);
        }
    }
    catch (_e) {
        console.error(bold(yellow("Failed to decode URL host") + "\nDefaulting to raw host"));
    }
    if (port && Number.isNaN(Number(port))) {
        throw new Error(`The provided port "${port}" is not a valid number`);
    }
    try {
        if (password) {
            password = decodeURIComponent(password);
        }
    }
    catch (_e) {
        console.error(bold(yellow("Failed to decode URL password") +
            "\nDefaulting to raw password"));
    }
    return {
        driver,
        host,
        params: Object.fromEntries(new URLSearchParams(params).entries()),
        password,
        path,
        port,
        user,
    };
}
export function isTemplateString(template) {
    if (!Array.isArray(template)) {
        return false;
    }
    return true;
}
export const getSocketName = (port) => `.s.PGSQL.${port}`;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLFlBQVksQ0FBQztBQUUxQyxNQUFNLFVBQVUsV0FBVyxDQUFDLE1BQWtCLEVBQUUsTUFBYztJQUM1RCxNQUFNLEdBQUcsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUN0QixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELE9BQU8sR0FBRyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO0FBQy9DLENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLE1BQWtCLEVBQUUsTUFBYztJQUM3RCxNQUFNLEdBQUcsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUN0QixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDcEQsQ0FBQztBQUVELE1BQU0sVUFBVSxXQUFXLENBQUMsTUFBa0IsRUFBRSxNQUFjO0lBQzVELE1BQU0sR0FBRyxNQUFNLEtBQUssQ0FBQyxDQUFDO0lBRXRCLE9BQU8sQ0FDTCxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMxQixDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQ25CLENBQUM7QUFDSixDQUFDO0FBRUQs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IFwiLi4vZGVwcy50c1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gcmVhZEludDE2QkUoYnVmZmVyOiBVaW50OEFycmF5LCBvZmZzZXQ6IG51bWJlcik6IG51bWJlciB7XG4gIG9mZnNldCA9IG9mZnNldCA+Pj4gMDtcbiAgY29uc3QgdmFsID0gYnVmZmVyW29mZnNldCArIDFdIHwgKGJ1ZmZlcltvZmZzZXRdIDw8IDgpO1xuICByZXR1cm4gdmFsICYgMHg4MDAwID8gdmFsIHwgMHhmZmZmMDAwMCA6IHZhbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRVSW50MTZCRShidWZmZXI6IFVpbnQ4QXJyYXksIG9mZnNldDogbnVtYmVyKTogbnVtYmVyIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwO1xuICByZXR1cm4gYnVmZmVyW29mZnNldF0gfCAoYnVmZmVyW29mZnNldCArIDFdIDw8IDgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZEludDMyQkUoYnVmZmVyOiBVaW50OEFycmF5LCBvZmZzZXQ6IG51bWJlcik6IG51bWJlciB7XG4gIG9mZnNldCA9IG9mZnNldCA+Pj4gMDtcblxuICByZXR1cm4gKFxuICAgIChidWZmZXJbb2Zmc2V0XSA8PCAyNCkgfFxuICAgIChidWZmZXJbb2Zmc2V0ICsgMV0gPDwgMTYpIHxcbiAgICAoYnVmZmVyW29mZnNldCArIDJdIDw8IDgpIHxcbiAgICBidWZmZXJbb2Zmc2V0ICsgM11cbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRVSW50MzJCRShidWZmZXI6IFVpbnQ4QXJyYXksIG9mZnNldDogbnVtYmVyKTogbnVtYmVyIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwO1xuXG4gIHJldHVybiAoXG4gICAgYnVmZmVyW29mZnNldF0gKiAweDEwMDAwMDAgK1xuICAgICgoYnVmZmVyW29mZnNldCArIDFdIDw8IDE2KSB8XG4gICAgICAoYnVmZmVyW29mZnNldCArIDJdIDw8IDgpIHxcbiAgICAgIGJ1ZmZlcltvZmZzZXQgKyAzXSlcbiAgKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcmkge1xuICBkcml2ZXI6IHN0cmluZztcbiAgaG9zdDogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xuICBwYXRoOiBzdHJpbmc7XG4gIHBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgcG9ydDogc3RyaW5nO1xuICB1c2VyOiBzdHJpbmc7XG59XG5cbi8qKlxuICogVGhpcyBmdW5jdGlvbiBwYXJzZXMgdmFsaWQgY29ubmVjdGlvbiBzdHJpbmdzIGFjY29yZGluZyB0byBodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9kb2NzLzE0L2xpYnBxLWNvbm5lY3QuaHRtbCNMSUJQUS1DT05OU1RSSU5HXG4gKlxuICogVGhlIG9ubHkgZXhjZXB0aW9uIHRvIHRoaXMgcnVsZSBhcmUgbXVsdGktaG9zdCBjb25uZWN0aW9uIHN0cmluZ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQ29ubmVjdGlvblVyaSh1cmk6IHN0cmluZyk6IFVyaSB7XG4gIGNvbnN0IHBhcnNlZF91cmkgPSB1cmkubWF0Y2goXG4gICAgLyg/PGRyaXZlcj5cXHcrKTpcXC97Mn0oKD88dXNlcj5bXlxcLz8jXFxzOl0rPyk/KDooPzxwYXNzd29yZD5bXlxcLz8jXFxzXSspPyk/QCk/KD88ZnVsbF9ob3N0PlteXFwvPyNcXHNdKyk/KFxcLyg/PHBhdGg+W14/I1xcc10qKSk/KFxcPyg/PHBhcmFtcz5bXiNcXHNdKykpPy4qLyxcbiAgKTtcbiAgaWYgKCFwYXJzZWRfdXJpKSB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgcGFyc2UgdGhlIHByb3ZpZGVkIFVSTFwiKTtcbiAgbGV0IHtcbiAgICBkcml2ZXIgPSBcIlwiLFxuICAgIGZ1bGxfaG9zdCA9IFwiXCIsXG4gICAgcGFyYW1zID0gXCJcIixcbiAgICBwYXNzd29yZCA9IFwiXCIsXG4gICAgcGF0aCA9IFwiXCIsXG4gICAgdXNlciA9IFwiXCIsXG4gIH06IHtcbiAgICBkcml2ZXI/OiBzdHJpbmc7XG4gICAgdXNlcj86IHN0cmluZztcbiAgICBwYXNzd29yZD86IHN0cmluZztcbiAgICBmdWxsX2hvc3Q/OiBzdHJpbmc7XG4gICAgcGF0aD86IHN0cmluZztcbiAgICBwYXJhbXM/OiBzdHJpbmc7XG4gIH0gPSBwYXJzZWRfdXJpLmdyb3VwcyA/PyB7fTtcblxuICBjb25zdCBwYXJzZWRfaG9zdCA9IGZ1bGxfaG9zdC5tYXRjaChcbiAgICAvKD88aG9zdD4oXFxbLitcXF0pfCguKj8pKSg6KD88cG9ydD5bXFx3XSopKT8kLyxcbiAgKTtcbiAgaWYgKCFwYXJzZWRfaG9zdCkgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgcGFyc2UgXCIke2Z1bGxfaG9zdH1cIiBob3N0YCk7XG4gIGxldCB7XG4gICAgaG9zdCA9IFwiXCIsXG4gICAgcG9ydCA9IFwiXCIsXG4gIH06IHtcbiAgICBob3N0Pzogc3RyaW5nO1xuICAgIHBvcnQ/OiBzdHJpbmc7XG4gIH0gPSBwYXJzZWRfaG9zdC5ncm91cHMgPz8ge307XG5cbiAgdHJ5IHtcbiAgICBpZiAoaG9zdCkge1xuICAgICAgaG9zdCA9IGRlY29kZVVSSUNvbXBvbmVudChob3N0KTtcbiAgICB9XG4gIH0gY2F0Y2ggKF9lKSB7XG4gICAgY29uc29sZS5lcnJvcihcbiAgICAgIGJvbGQoXG4gICAgICAgIHllbGxvdyhcIkZhaWxlZCB0byBkZWNvZGUgVVJMIGhvc3RcIikgKyBcIlxcbkRlZmF1bHRpbmcgdG8gcmF3IGhvc3RcIixcbiAgICAgICksXG4gICAgKTtcbiAgfVxuXG4gIGlmIChwb3J0ICYmIE51bWJlci5pc05hTihOdW1iZXIocG9ydCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcHJvdmlkZWQgcG9ydCBcIiR7cG9ydH1cIiBpcyBub3QgYSB2YWxpZCBudW1iZXJgKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgaWYgKHBhc3N3b3JkKSB7XG4gICAgICBwYXNzd29yZCA9IGRlY29kZVVSSUNvbXBvbmVudChwYXNzd29yZCk7XG4gICAgfVxuICB9IGNhdGNoIChfZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICBib2xkKFxuICAgICAgICB5ZWxsb3coXCJGYWlsZWQgdG8gZGVjb2RlIFVSTCBwYXNzd29yZFwiKSArXG4gICAgICAgICAgXCJcXG5EZWZhdWx0aW5nIHRvIHJhdyBwYXNzd29yZFwiLFxuICAgICAgKSxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBkcml2ZXIsXG4gICAgaG9zdCxcbiAgICBwYXJhbXM6IE9iamVjdC5mcm9tRW50cmllcyhuZXcgVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykuZW50cmllcygpKSxcbiAgICBwYXNzd29yZCxcbiAgICBwYXRoLFxuICAgIHBvcnQsXG4gICAgdXNlcixcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzVGVtcGxhdGVTdHJpbmcoXG4gIHRlbXBsYXRlOiB1bmtub3duLFxuKTogdGVtcGxhdGUgaXMgVGVtcGxhdGVTdHJpbmdzQXJyYXkge1xuICBpZiAoIUFycmF5LmlzQXJyYXkodGVtcGxhdGUpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIGh0dHBzOi8vd3d3LnBvc3RncmVzcWwub3JnL2RvY3MvMTQvcnVudGltZS1jb25maWctY29ubmVjdGlvbi5odG1sI1JVTlRJTUUtQ09ORklHLUNPTk5FQ1RJT04tU0VUVElOR1NcbiAqIHVuaXhfc29ja2V0X2RpcmVjdG9yaWVzXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRTb2NrZXROYW1lID0gKHBvcnQ6IG51bWJlcikgPT4gYC5zLlBHU1FMLiR7cG9ydH1gO1xuIl19